{% extends 'main/base.html' %}

{% block content %}
    <section class="section">
        <div class="view-container is-fullhd">
            <div class="tags visibility-tags">
                <span class="tag is-light">Dossier {{ doc.id }}</span>

                <span class="tag">
                    <a id="visibility-image"><span><i class="fas fa-eye active"></i><i class="fas fa-eye-slash inactive" style="display:none"></i></span>image</a>
                    <a id="visibility-notice"><span><i class="fas fa-eye active"></i><i class="fas fa-eye-slash inactive" style="display:none"></i></span>notice</a>
                    <a id="visibility-transcription"><span><i class="fas fa-eye active"></i><i class="fas fa-eye-slash inactive" style="display:none"></i></span>transcription</a>
                    <a id="visibility-translation"><span><i class="fas fa-eye active"></i><i class="fas fa-eye-slash inactive" style="display:none"></i></span>traduction</a>
                    <a id="visibility-commentaries"><span><i class="fas fa-eye active"></i><i class="fas fa-eye-slash inactive" style="display:none"></i></span>commentaires</a>
                    <a id="visibility-speech-parts"><span><i class="fas fa-eye active"></i><i class="fas fa-eye-slash inactive" style="display:none"></i></span>parties du discours</a>
                </span>
            </div>

            <div class="columns">
                <div class="column is-4" id="img-col">
                    {% if doc.images|length > 0 %}
                    <figure class="image">
                        <img src="http://193.48.42.68/loris/adele/dossiers/{{ doc.id }}.jpg/full/full/0/default.jpg" />
                    </figure>
                    <div id="iiif-map"></div>
                    {% else %}
                    <div class="box empty-image">
                        <div class="empty-thumbnail"><i class="fas fa-file-alt"></i></div>
                    </div>
                    {% endif %}
                </div>
                <div class="column" id="text-col">
                    <div class="tabs">
                        <ul>
                        {% if can_edit %}
                        <li><a class="button tag is-primary edit-document" href="{{url_for('app_bp.document_edit', doc_id=doc.id)}}"><i class="fas fa-edit"></i><p>Ã‰diter</p></a></li>
                        {% endif %}
                        <li class="tab is-active"><input type="hidden" value="tab-notice"/><a>Notice</a></li>
                        <li class="tab"><input type="hidden" value="tab-transcription"/><a>Transcription</a></li>
                        <li class="tab"><input type="hidden" value="tab-commentaries"/><a>Commentaires</a></li>
                        <li class="tab"><input type="hidden" value="tab-speech-parts"/><a>Parties du discours</a></li>
                        </ul>
                    </div>
                    <div class="tab-content" id="tab-notice"></div>
                    <div class="tab-content" id="tab-transcription"></div>
                    <div class="tab-content" id="tab-commentaries"></div>
                    <div class="tab-content" id="tab-speech-parts"></div>
                </div>
            </div>
        </div>
    </section>
{% endblock content %}

{% block breadcrumb %}
    <div class="navbar-item breadcrumb-arrow">
        <i class="fas fa-angle-right"></i>
    </div>
    <div class="navbar-item"><a class="is-text">{{ doc.title }}</a> </div>
{% endblock %}

{% block scripts %}
   <script src="{{ url_for('app_bp.static', filename='js/jquery.min.js') }}"></script>
   <script type="text/javascript">
       $(document).ready(function () {

           function load_notice_tab(){
               let url = "{{ url_for('app_bp.view_document_notice',  doc_id='DOC_ID_PLACEHOLDER') }}";
               url = url.replace('DOC_ID_PLACEHOLDER', {{doc.id}});
               $.ajax({ url: url }).done(
                   function (data) {
                       $('#tab-notice').html(data);
                   }
               );
           }

           function load_transcription_tab(){
               let url = "{{ url_for('app_bp.view_document_transcription_alignment', doc_id='DOC_ID_PLACEHOLDER') }}";
               url = url.replace('DOC_ID_PLACEHOLDER', {{doc.id}});
               $.ajax({
                   url: url
               }).done(function (data) {
                    $('#tab-transcription').html(data);
                    $('#transcription-container').css('display', 'none');
                    $('#translation-container').css('display', 'none');
               });
           }

           function load_commentaries_tab(){
               let url = "{{ url_for('app_bp.view_document_commentaries',  doc_id='DOC_ID_PLACEHOLDER') }}";
               url = url.replace('DOC_ID_PLACEHOLDER', {{doc.id}});
               $.ajax({ url: url }).done(
                   function (data) {
                       $('#tab-commentaries').html(data);
                   }
               );
           }

           function load_speech_parts_tab(){
               let url = "{{ url_for('app_bp.view_document_speech_parts',  doc_id='DOC_ID_PLACEHOLDER') }}";
               url = url.replace('DOC_ID_PLACEHOLDER', {{doc.id}});
               $.ajax({ url: url }).done(
                   function (data) {
                       $('#tab-speech-parts').html(data);
                   }
               );
           }

           /*
                Tab managment
           */
           function go_to_tab(tab_id) {
               $('.tab-content').hide();
               $('#' + tab_id).show();

               $('#visibility-notice').hide();
               $('#visibility-transcription').hide();
               $('#visibility-translation').hide();
               $('#visibility-commentaries').hide();
               $('#visibility-speech-parts').hide();

               switch (tab_id) {
                   case 'tab-notice':
                       $('#visibility-notice').show();
                       break;
                   case 'tab-transcription':
                       $('#visibility-transcription').show();
                       $('#visibility-translation').show();
                       break;
                   case 'tab-commentaries':
                       $('#visibility-commentaries').show();
                       break;
                   case 'tab-speech-parts':
                       $('#visibility-speech-parts').show();
                       break;
               }
           }

           $('.tab').click(function() {
               const tab_id = $(this).find('input[type="hidden"]').val();
               go_to_tab(tab_id);
               $('.tab.is-active').removeClass('is-active');
               $(this).addClass('is-active');
           });

           /*
                Load data & select the notice tab;
           */
           load_notice_tab();
           load_transcription_tab(); // also load translation & speech-parts
           load_commentaries_tab();
           load_speech_parts_tab();

           go_to_tab('tab-notice');

           /*
                set up visibility filters
           */
           function toggleTextCol(t) {
               if ($('#text-col').css('display') === 'none'){
                   $('#text-col').show();
                   $('#img-col').addClass('is-4');
               }
               else {
                   $('#text-col').hide();
                   $('#img-col').removeClass('is-4');
               }
               $(t).find('.active,.inactive').toggle();
           }

           $('#visibility-image').click(function(){
               if ($('#img-col').css('display') === 'none'){
                   $('#img-col').show();
               }
               else {
                   $('#img-col').hide();
               }
               $(this).find('.active,.inactive').toggle();
           });
           $('#visibility-notice').click(function(){toggleTextCol(this)});
           $('#visibility-commentaries').click(function(){toggleTextCol(this)});
           $('#visibility-speech-parts').click(function(){toggleTextCol(this)});
           $('#visibility-transcription').click(function(){
               if ($('#transcription-container').css('display') === 'none'){
                   if ($('#translation-container').css('display') === 'block'){
                       $('#transcription-alignment-container').show();
                       $('#translation-container').hide();
                   }
                   else {
                       if ($('#text-col').css('display') === 'block') {
                           $('#translation-container').show();
                       }
                       else {
                         $('#transcription-container').show();
                       }
                       $('#transcription-alignment-container').hide();
                   }
                   $('#img-col').addClass('is-4');
               }
               else {
                  $('#transcription-container').hide();
               }

               if ($('#transcription-container').css('display') === 'none'
                    && $('#translation-container').css('display') === 'none'
                    && $('#transcription-alignment-container').css('display') === 'none'){
                 $('#text-col').hide();
                 $('#img-col').removeClass('is-4');
               } else {
                 $('#text-col').show();
               }

               $(this).find('.active,.inactive').toggle();
           });
           $('#visibility-translation').click(function(){
               if ($('#translation-container').css('display') === 'none'){
                   if ($('#transcription-container').css('display') === 'block'){
                       $('#transcription-alignment-container').show();
                       $('#transcription-container').hide();
                   }
                   else {
                       if ($('#text-col').css('display') === 'block') {
                           $('#transcription-container').show();
                       } else {
                           $('#translation-container').show();
                       }
                       $('#transcription-alignment-container').hide();
                   }
                   $('#img-col').addClass('is-4');
               }
               else {
                  $('#translation-container').hide();
               }

               if ($('#transcription-container').css('display') === 'none'
                    && $('#translation-container').css('display') === 'none'
                    && $('#transcription-alignment-container').css('display') === 'none'){
                 $('#text-col').hide();
                 $('#img-col').removeClass('is-4')
               } else {
                 $('#text-col').show();
               }

               $(this).find('.active,.inactive').toggle();
           });

       });
   </script>
{% endblock %}