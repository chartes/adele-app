{% extends 'main/base.html' %}

{% block content %}

    <section class="section">
        <div class="view-container is-fullhd">
            <div class="columns">
                <div class="column is-4">
                    <figure class="image">
                        <img src="http://193.48.42.68/loris/adele/dossiers/{{ doc.id }}.jpg/full/full/0/default.jpg" />
                    </figure>
                </div>
                <div class="column">
                    <div class="tabs">
                        <ul>
                        <li class="tab is-active"><input type="hidden" value="tab-notice"/><a>Notice</a></li>
                        <li class="tab"><input type="hidden" value="tab-transcription"/><a>Transcription</a></li>
                        <li class="tab"><input type="hidden" value="tab-commentaries"/><a>Commentaires</a></li>
                        <li class="tab"><input type="hidden" value="tab-speech-parts"/><a>Parties du discours</a></li>
                        </ul>
                    </div>
                    <div class="tab-content" id="tab-notice">
                        <div class="content">
                            <p>
                                <span class="tag is-light">Dossier {{ doc.id }}</span>
                                {% if can_edit %}
                                    <a class="tag is-primary" href="{{url_for('app_bp.document_edit', doc_id=doc.id)}}">Éditer</a>
                                {% endif %}
                                <!--
                                <span class="tag is-light">Créé le {{ doc.date_insert }}</span>
                                <span class="tag is-light">Dern. modif. le {{ doc.date_update }}</span>
                                -->
                            </p>
                            <p class="title is-3">{{ doc.title }}</p>
                            <p>{{ doc.subtitle }}</p>
                        </div>

                        <hr>

                        <p class="title is-4">Métadonnées</p>
                        {% if doc.creation_lab %}
                        <p><strong>creation_lab : </strong>{{ doc.creation_lab }}</p>
                        {% endif %}
                        {% if doc.copy_year %}
                        <p><strong>copy_year : </strong>{{ doc.copy_year }}</p>
                        {% endif %}
                        {% if doc.copy_cent %}
                        <p><strong>copy_cent : </strong>{{ doc.copy_cent }}</p>
                        {% endif %}
                        {% if doc.institution %}
                        <p><strong>Institution : </strong><a href="{{ doc.institution.ref }}" target="_blank">{{ doc.institution.name }}</a></p>
                        {% endif %}
                        {% if doc.pressmark %}
                        <p><strong>pressmark : </strong>{{ doc.pressmark }}</p>
                        {% endif %}
                        {% if doc.argument %}
                        <p><strong>argument : </strong>{{ doc.argument|safe }}</p>
                        {% endif %}
                        <p>&nbsp;</p>

                        <p class="title is-6">Liaisons</p>

                        <div>
                            <p><strong>Type d'acte :</strong></p>
                            <ul>
                                {% for acte_type in doc.acte_types %}
                                <li>{{ acte_type.label }}</li>
                                {% endfor %}
                            </ul>
                        </div>
                        <div>
                            <p><strong>Traditions :</strong></p>
                            <ul>
                                {% for tradition in doc.traditions %}
                                <li>{{ tradition.label }}</li>
                                {% endfor %}
                            </ul>
                        </div>
                        <div>
                            <p><strong>Pays :</strong></p>
                            <ul>
                                {% for country in doc.countries %}
                                <li><a href="{{ country.ref }}" target="_blank">{{ country.label }}</a></li>
                                {% endfor %}
                            </ul>
                        </div>
                        <div>
                            <p><strong>District(s) :</strong></p>
                            <ul>
                                {% for district in doc.districts %}
                                <li>{{ district.label }}</li>
                                {% endfor %}
                            </ul>
                        </div>
                        <div>
                            <p><strong>Langages :</strong></p>
                            <ul>
                                {% for lang in doc.languages %}
                                <li>{{ lang.label }}</li>
                                {% endfor %}
                            </ul>
                        </div>
                        <div>
                            <p><strong>Editeurs :</strong></p>
                            <ul>
                                {% for editor in doc.editors %}
                                <li>{{ editor.name }}</li>
                                {% endfor %}
                            </ul>
                        </div>
                        <div>
                            <p><strong>Transcriptions :</strong> {{ doc.transcription_id_collection|length }}</p>
                            <p><strong>Traductions :</strong> {{ doc.translation_id_collection|length }}</p>
                            <p><strong>Commentaires :</strong> {{ doc.commentary_id_collection|length }}</p>
                        </div>
                        <div>
                            <p><strong>Documents liés :</strong></p>
                            <ul>
                                {% for linked_doc in doc.document_linked_id_collection %}
                                <li><a href="{{ url_for("app_bp.document_edit", doc_id=d.id) }}">{{ linked_doc.id }} {{ linked_doc.title }}</a></li>
                                {% endfor %}
                            </ul>
                        </div>

                        <p><a href="#" class="button is-light">Editer les métadonnées</a></p>

                        <hr>
                        </div>

                    <div class="tab-content" id="tab-transcription">
                        <p class="content" id="transcription-container"></p>
                        <p class="content" id="translation-container"></p>
                        <p class="content" id="transcription-alignment-container"></p>
                    </div>
                    <div class="tab-content" id="tab-commentaries">
                         <p class="content" id="commentaries-container"></p>
                    </div>
                    <div class="tab-content" id="tab-speech-parts">
                        <p class="content" id="speech-parts-container"></p>
                    </div>
                </div>
            </div>
        </div>
    </section>
{% endblock content %}

{% block breadcrumb %}
    <div class="navbar-item breadcrumb-arrow">
        <i class="fas fa-angle-right"></i>
    </div>
    <div class="navbar-item"><a class="is-text">{{ doc.title }}</a> </div>
{% endblock %}

{% block scripts %}
   <script src="{{ url_for('app_bp.static', filename='js/jquery.min.js') }}"></script>
   <script type="text/javascript">
       $(document).ready(function () {

           function go_to_tab(tab_id) {
               $('.tab-content').hide();
               $('#' + tab_id).show();
           }

           $('.tab').click(function() {
               const tab_id = $(this).find('input[type="hidden"]').val();
               go_to_tab(tab_id);
               $('.tab.is-active').removeClass('is-active');
               $(this).addClass('is-active');
           });

           function load_transcription(){
               let url = "{{ url_for('api_bp.api_documents_transcriptions_reference', api_version='1.0', doc_id='DOC_ID_PLACEHOLDER') }}";
               url = url.replace('DOC_ID_PLACEHOLDER', {{doc.id}});
               $.ajax({
                   url: url
               }).done(function (data) {
                   if (!data.errors){
                       $('#transcription-container').html(data.data.content);
                   }
               });
           }

           function load_translation(){
               let url = "{{ url_for('api_bp.api_documents_translations_reference', api_version='1.0', doc_id='DOC_ID_PLACEHOLDER') }}";
               url = url.replace('DOC_ID_PLACEHOLDER', {{doc.id}});
               $.ajax({
                   url: url
               }).done(function (data) {
                   console.log(data);
                   if (!data.errors){
                       $('#translation-container').html(data.data.content);
                   }
               });
           }

           function load_transcription_alignment(){
               let url = "{{ url_for('api_bp.api_documents_transcriptions_alignments_reference', api_version='1.0', doc_id='DOC_ID_PLACEHOLDER') }}";
               url = url.replace('DOC_ID_PLACEHOLDER', {{doc.id}});
               $.ajax({
                   url: url
               }).done(function (data) {
                   console.log(data);
                   if (!data.errors){
                       //$('#transcription-alignment-container').html(data.data.toString());
                   }
               });
           }



           function load_commentaries(){
               let url = "{{ url_for('api_bp.api_commentary_reference', api_version='1.0', doc_id='DOC_ID_PLACEHOLDER') }}";
               url = url.replace('DOC_ID_PLACEHOLDER', {{doc.id}});

               function make_commentary(com) {
                   c = "<div id='commentary-"+ com.id +"'>" +
                       "    <div class='title'>" + com.type.label + "</div>" +
                       "    <p>" + com.content + "</p>"
                       "</div>";
                   return c;
               }

               $.ajax({
                   url: url
               }).done(function (data) {
                   console.log(data);
                   if (!data.errors){
                       for (let com of data.data) {
                           $('#commentaries-container').append(
                               make_commentary(com)
                           );
                       }
                   }
               });
           }

           function load_speech_parts(){
               let url = "{{ url_for('api_bp.api_documents_transcriptions_alignments_discours_reference', api_version='1.0', doc_id='DOC_ID_PLACEHOLDER') }}";
               url = url.replace('DOC_ID_PLACEHOLDER', {{doc.id}});
               $.ajax({
                   url: url
               }).done(function (data) {
                   console.log("speech parts");
                   console.log(data);
                   if (!data.errors){
                       $('#speech-parts-container').html(data.data.toString());
                   }
               });
           }


           /*
                Load data & select the notice tab;
            */
           load_transcription();
           load_translation();
           load_transcription_alignment();
           load_commentaries();
           load_speech_parts();

           go_to_tab('tab-notice');
       });
   </script>
{% endblock %}